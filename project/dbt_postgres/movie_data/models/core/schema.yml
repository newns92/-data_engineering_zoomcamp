version: 2

models:
    - name: dim_languages
      description: List of unique movie release languages from ISO 639-1
      columns:
          - name: language_record_id
            description: Unique ID (primary key) for the record
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
          - name: full_language_name
            description: The full movie release language name, in English
          - name: language_key
            description: The ISO 639-1 language abbreviation
            # THIS TEST RETURNS A WARNING SINCE EVERY LANGUAGE ABBREV IS NOT PRESENT IN THE FACT TABLE
            # tests:
            #   - relationships:
            #       to: ref('fact_movies')
            #       field: 'language_key'
            #       severity: warn

    - name: dim_genres
      description: List of genre ID's generated by TMDB and their respective genre names
      columns:
          - name: genre_id
            description: Unique ID (primary key) for the record
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
                - relationships:
                    to: ref('dim_genres_bridge')
                    field: 'genre_id'
                    severity: warn
          - name: genre_name
            description: The movie genre name, in English

    - name: dim_genres_bridge
      description: A bridge table to link the movie fact table with the genre dimension table
      columns:
          - name: genre_key
            description: Unique ID (primary key) for the record, potentially a combination of genre ID's
            tests:
                # - unique:
                #     severity: warn
                - not_null:
                    severity: warn
          - name: genre_id
            description: The split-out movie genre ID from the unique genre key
            tests:
              - relationships:
                  to: ref('dim_genres')
                  field: 'genre_id'
                  severity: warn

    - name: fact_movies
      description: All movie data from TMDB, uniquely identified by record_id
      columns:
          - name: record_id
            description: Primary key for this table, a surrogate key generated by Postgres
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
          - name: movie_id
            description: A movie's identification number from TMDB
          - name: title 
            description: The movie title, in English
          - name: language_key 
            description: The original release language of the movie, in ISO 639-1 format            
            # check if this field is located in the language dimensions table
            tests:
              - relationships:
                  to: ref('dim_languages')
                  field: 'language_key'
                  severity: warn
          - name: revenue
            description: The movie's total current revenue, in US Dollars
          - name: budget
            description: The movie's budget, in US Dollars
          - name: earned_back
            description: The multiplier of how much revenue the movie earned over the movie's budget
          - name: runtime
            description: The movie's runtime, in minutes
          - name: popularity_score 
            description: A popularity score depending on several factors as calculated by TMDB (https://developer.themoviedb.org/docs/popularity-and-trending)
          - name: release_date 
            description: The original release date of the movie
          - name: average_rating
            description: The movie's average on a scale from 0.0 to 10.0
          - name: rating_count
            description: The number of ratings/votes for a movie