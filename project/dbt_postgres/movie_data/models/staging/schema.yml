version: 2

sources:
  - name: staging
    database: movie_data  # i.e., the Postgres database
    schema: public  # the Postgres schema

    tables:
      - name: movie_data_info
      - name: movie_language_info
      - name: movie_genres_info

models:
    - name: stg_movie_data_info
      description: Basic movie data information from the main request to TMDB's API
      columns:
          - name: record_id
            description: Primary key for this table, a surrogate key generated by Postgres
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
          - name: movie_id
            description: A movie's identification number from TMDB
          - name: title 
            description: The movie title, in English
          - name: language_key 
            description: The original release language of the movie, in ISO 639 format
            # check if this field is located in the zone lookup table            
            tests:
              - relationships:
                  to: ref('stg_movie_languages')
                  field: 'language_key'
                  severity: warn
          - name: popularity_score 
            description: A popularity score depending on several factors as calculated by TMDB (https://developer.themoviedb.org/docs/popularity-and-trending)
          - name: release_date 
            description: The original release date of the movie
          - name: average_rating
            description: The movie's average on a scale from 0.0 to 10.0
          - name: rating_count
            description: The number of ratings/votes for a movie
          #   # check if this field is located in the zone lookup table            
          #   tests:
          #     - relationships:
          #         to: ref('taxi_zone_lookup')
          #         field: '"LocationID"'
          #         severity: warn
          # - name: dropoff_locationid 
          #   description: locationid where the meter was engaged.
          #   # check if this field is located in the zone lookup table            
          #   tests:
          #     - relationships:
          #         to: ref('taxi_zone_lookup')
          #         field: '"LocationID"'
          # - name: Payment_type 
          #   description: >
          #     A numeric code signifying how the passenger paid for the trip.
          #   tests: 
          #     - accepted_values:
          #         values: "{{ var('payment_type_values') }}"
          #         severity: warn
          #         quote: false

    - name: stg_movie_languages
      description: ISO 639-1 languages and their abbreviations/codes
      columns:
          - name: language_record_id
            description: Primary key for this table, a surrogate key generated by Postgres
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
          - name: full_language_name
            description: The full language name, in English
          - name: language_key 
            description: The language's abbreviation, according to ISO 639-1

    - name: stg_movie_genres
      description: TMDB ID's and genre names of the current most popular movies
      columns:
          - name: genre_id
            description: Primary key for this table, a key generated by TMDB
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
          - name: genre_name
            description: The full name of the genre, in English

    - name: stg_movie_genres_bridge
      description: Concatenated TMDB ID's for each movie, split out into individual genre id's for a bridge table.
      columns:
          - name: genre_key
            description: Primary key for this table, a key generated by concatenating all genre ID's for a movie
            tests:
                - unique:
                    severity: warn
                - not_null:
                    severity: warn
          - name: genre_id
            description: A key generated by TMDB to match to the final genres table, dim_genres
            # check if this field is located in the zone lookup table            
            tests:
              - relationships:
                  to: ref('stg_movie_genres')
                  field: 'genre_id'
                  severity: warn